Developer Onboarding Guide
Multi-Segment Options Trading App (NFO + BFO)

Frontend + FastAPI Backend + Kotak API Integration

ğŸ“Œ 1. Project Overview

This application is a full-stack Options Trading Dashboard that supports:

NFO (NSE Derivatives) â†’ NIFTY, BANKNIFTY, FINNIFTY, MIDCPNIFTY

BFO (BSE Derivatives) â†’ SENSEX, BANKEX

Dynamic index + expiry loading

Option chain display

One-click order placement

Correct routing of NSE vs BSE orders via Kotak APIs

The project consists of:

Component	Technology	Files
Frontend	HTML, CSS, JS	index.html, dashboard.js, styles.css
Backend	FastAPI (Python)	main.py, KotakNiftyAPI.py
Data	CSV Masters	nfo_master.csv, bfo_master.csv
ğŸ›  2. Folder Structure
project/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ KotakNiftyAPI.py
â”‚   â”œâ”€â”€ session_cache.json
â”‚   â”œâ”€â”€ users.json
â”‚   â”œâ”€â”€ nfo_master.csv
â”‚   â”œâ”€â”€ bfo_master.csv
â”‚
â””â”€â”€ frontend/
    â”œâ”€â”€ index.html
    â”œâ”€â”€ dashboard.js
    â”œâ”€â”€ styles.css

âš™ï¸ 3. Setup Instructions
âœ… Backend Setup (FastAPI)
1. Install dependencies
pip install fastapi uvicorn requests python-multipart

2. Start backend server
uvicorn main:app --reload --port 8000


Backend will start at:

http://localhost:8000

3. Required files for backend to run:

Kotak Master CSV files
Containing symbol definitions for NFO/BFO
(Your project uses local CSVs for lookup)

session_cache.json
Stores login sessions

users.json
Contains login credentials for Kotak API wrapper

âœ… Frontend Setup

Open frontend/index.html in any browser

Ensure backend is running

The option chain will load automatically

Toggle NFO/BFO from the dropdown

Nothing else to install â€” frontend is static.

ğŸ”Œ 4. How System Works

The application follows a clean two-way flow:

Frontend Flow
1ï¸âƒ£ Segment Toggle (NFO â†” BFO)

Triggers:

POST /api/switch-segment


Updates:

Index dropdown

Expiry dropdown

Option-chain segment routing

2ï¸âƒ£ Index Dropdown

Selecting an index calls:

GET /api/expiries-v2?index=X&segment=S

3ï¸âƒ£ Expiry Dropdown

Selecting expiry calls:

GET /api/option-chain?index=X&expiry=Y&strikes=10&segment=S


Option chain table updates every few seconds.

4ï¸âƒ£ One-Click Order

When ON:

No confirmation

Auto-fetch correct lot size

Immediately triggers /api/place-order

When OFF:

Order popup or confirmation appears

Backend Flow
1ï¸âƒ£ /api/switch-segment

Stores active segment in server memory:

session.segment = "NFO" or "BFO"

2ï¸âƒ£ /api/expiries-v2

Reads master CSV â†’ returns list of dates per index.

3ï¸âƒ£ /api/option-chain

Builds option chain by:

Parsing SENSEX/NIFTY symbol formats

Determining correct exchange API:

nse_cm / nse_fo (NFO)

bse_cm / bse_fo (BFO)

Fetching quotes

Returning chain structure

4ï¸âƒ£ /api/place-order

This was a major fix:

Backend sets:

"es": "nse_fo" if segment == "NFO"
"es": "bse_fo" if segment == "BFO"


So orders reach correct exchange.

ğŸ§  5. Key Concepts Developers Must Know
âœ” Segment Awareness

Everything in the system depends on correct segment routing:

Segment	Exchange	Symbols	es Value
NFO	NSE	NIFTY, BANKNIFTY	nse_fo
BFO	BSE	SENSEX, BANKEX	bse_fo
âœ” Symbol Parsing

Backend automatically parses:

Weekly & monthly formats

SENSEXâ€™s special date codes

FUT names

CE/PE endings

No manual formatting needed by frontend.

âœ” Expiry Filtering

Frontend only displays future expiries.

Backend returns all expiries, but frontend filters UI.

âœ” One-Click Mode Uses Lot-Size API
GET /api/lot-size


Ensures trades use correct contract size.

ğŸ”’ 6. Developer Doâ€™s & Donâ€™ts
âœ” DO:

Use segment parameter on all API calls

Always call /api/switch-segment when toggling NFO/BFO

Keep symbol formats untouched; backend parses everything

Handle network errors gracefully

âŒ DONâ€™T:

Hardcode lot sizes

Hardcode index lists

Call /api/option-chain before expiries load

Skip sending segment when placing orders

ğŸ§© 7. What to Modify if Developer Adds New Features
Feature	File to Change	Notes
Add new index (e.g., NIFTY FIN SERVICE)	dashboard.js index lists	Ensure backend CSV contains symbol
Add new segment	backend switch-segment, place_order	Must map to correct "es"
Custom order types	frontend placeConfirmedOrder	Must be supported by Kotak
UI changes	index.html, styles.css	Pure frontend
ğŸ¯ 8. Quick Start Checklist

A developer can verify system is working by checking:

âœ… NIFTY option chain loads
âœ… SENSEX option chain loads
âœ… Expiries show correctly for both
âœ… One-click order places immediately
âœ… SENSEX/BANKEX orders reach broker (BFO fix)
âŒ No â€œNo Dates Foundâ€ after segment switching
ğŸ You're Ready to Share This Project

This guide is everything a new developer needs:

How the system works

How to run it

Where each piece lives

How NFO/BFO routing behaves

What the backend expects

How One-Click mode works

What to do and not to do

 scheduleNextUpdate() {
        // Temporary no-op to avoid errors; real logic can be added later
    }




















getOrderDetailsFromForm()

calculateOrderSummary()

